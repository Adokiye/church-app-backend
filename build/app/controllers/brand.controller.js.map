{"version":3,"sources":["../../../src/app/controllers/brand.controller.js"],"names":["createBrand","ctx","id","params","body","request","role","state","user","Brand","query","insert","e","console","log","UnprocessableEntity","brand_data","status","message","updateBrand","posist_data","patchAndFetchById","getBrandsForCustomer","lat","lng","CokitchenPolygon","withGraphFetched","cokitchen_polygons","cokitchens","i","len","length","polygon","push","cokitchen","data","brands"],"mappings":"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","sourcesContent":["import Brand from '../models/brand'\nimport Cokitchen from '../models/cokitchen'\nimport CokitchenPolygon from '../models/cokitchen_polygon'\nimport { checkIfAdmin, checkIfMarketing } from '../services/RoleService'\nimport { Unauthorized, insidePolygon } from '../helpers'\n\nexport const createBrand = async ctx => {\n  const { id } = ctx.params\n  const { body } = ctx.request\n  const { role } = ctx.state.user.user\n\n  if (await checkIfMarketing(role)) {\n    const brand_data = await Brand.query().insert(body)\n    .catch((e) => {\n      console.log(e)\n      throw UnprocessableEntity('Invalid body')\n    })\n    return {\n      status: 'success',\n      message: 'Brand Created Successfully',\n      ...brand_data\n    }\n  } else {\n    throw Unauthorized('Unauthorized Creation')\n  }\n}\n\nexport const updateBrand = async ctx => {\n  const { id } = ctx.params\n  const { body } = ctx.request\n  const { role } = ctx.state.user.user\n\n  if (await checkIfMarketing(role)) {\n    if (body.posist_data) {\n      delete body.posist_data\n    }\n    const brand_data = await Brand.query().patchAndFetchById(id, body)\n    return {\n      status: 'success',\n      message: 'Update Successful',\n      ...brand_data\n    }\n  } else {\n    throw Unauthorized('Unauthorized Update')\n  }\n}\n\nexport const getBrandsForCustomer = async ctx => {\n  const { body } = ctx.request\n  const { lat, lng } = body\n  const cokitchen_polygons = await CokitchenPolygon.query().withGraphFetched(\n    'cokitchen.[brands.[meals]]'\n  )\n  var cokitchens = []\n  var i = 0,\n    len = cokitchen_polygons.length\n  while (i < len) {\n    if (insidePolygon([lat, lng], cokitchen_polygons[i].polygon)) {\n      cokitchens.push(cokitchen_polygons[i].cokitchen)\n      return {\n        status: 'success',\n        data: cokitchen_polygons[i].cokitchen.brands\n      }\n    }\n\n    i++\n  }\n}\n"],"file":"brand.controller.js"}