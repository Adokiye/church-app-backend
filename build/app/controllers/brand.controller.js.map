{"version":3,"sources":["../../../src/app/controllers/brand.controller.js"],"names":["createBrand","ctx","id","params","body","request","role","state","user","Brand","query","insert","e","console","log","brand_data","status","message","updateBrand","brand_id","posist_data","patchAndFetchById","getBrandsForCustomer","lat","lng","CokitchenPolygon","withGraphFetched","cokitchen_polygons","cokitchens","i","len","length","polygon","push","cokitchen","data","brands","getBrandsForMarketing"],"mappings":";;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;;;AAEO,IAAMA,WAAW;AAAA,2FAAG,iBAAMC,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACjBC,YAAAA,EADiB,GACVD,GAAG,CAACE,MADM,CACjBD,EADiB;AAEjBE,YAAAA,IAFiB,GAERH,GAAG,CAACI,OAFI,CAEjBD,IAFiB;AAGjBE,YAAAA,IAHiB,GAGRL,GAAG,CAACM,KAAJ,CAAUC,IAAV,CAAeA,IAHP,CAGjBF,IAHiB;AAAA;AAAA,mBAKf,mCAAiBA,IAAjB,CALe;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAMEG,kBAAMC,KAAN,GACtBC,MADsB,CACfP,IADe,WAEhB,UAAAQ,CAAC,EAAI;AACVC,cAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACA,oBAAM,kCAAoB,cAApB,CAAN;AACD,aALsB,CANF;;AAAA;AAMjBG,YAAAA,UANiB;AAAA;AAarBC,cAAAA,MAAM,EAAE,SAba;AAcrBC,cAAAA,OAAO,EAAE;AAdY,eAelBF,UAfkB;;AAAA;AAAA,kBAkBjB,2BAAa,uBAAb,CAlBiB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAXf,WAAW;AAAA;AAAA;AAAA,GAAjB;;;;AAsBA,IAAMkB,WAAW;AAAA,4FAAG,kBAAMjB,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACjBG,YAAAA,IADiB,GACRH,GAAG,CAACI,OADI,CACjBD,IADiB;AAEjBE,YAAAA,IAFiB,GAERL,GAAG,CAACM,KAAJ,CAAUC,IAAV,CAAeA,IAFP,CAEjBF,IAFiB;AAGnBa,YAAAA,QAHmB,GAGRf,IAAI,CAACe,QAHG;AAIzB,mBAAOf,IAAI,CAACe,QAAZ;AAJyB;AAAA,mBAKf,mCAAiBb,IAAjB,CALe;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAMvB,gBAAIF,IAAI,CAACgB,WAAT,EAAsB;AACpB,qBAAOhB,IAAI,CAACgB,WAAZ;AACD;;AARsB;AAAA,mBASEX,kBAAMC,KAAN,GAAcW,iBAAd,CACvBF,QADuB,EAEvBf,IAFuB,CATF;;AAAA;AASjBW,YAAAA,UATiB;AAAA;AAcrBC,cAAAA,MAAM,EAAE,SAda;AAerBC,cAAAA,OAAO,EAAE;AAfY,eAgBlBF,UAhBkB;;AAAA;AAAA,kBAmBjB,2BAAa,qBAAb,CAnBiB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAXG,WAAW;AAAA;AAAA;AAAA,GAAjB;;;;AAuBA,IAAMI,oBAAoB;AAAA,4FAAG,kBAAMrB,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAC1BG,YAAAA,IAD0B,GACjBH,GAAG,CAACI,OADa,CAC1BD,IAD0B;AAE1BmB,YAAAA,GAF0B,GAEbnB,IAFa,CAE1BmB,GAF0B,EAErBC,GAFqB,GAEbpB,IAFa,CAErBoB,GAFqB;AAAA;AAAA,mBAGDC,8BAAiBf,KAAjB,GAAyBgB,gBAAzB,CAC/B,8BAD+B,CAHC;;AAAA;AAG5BC,YAAAA,kBAH4B;AAM9BC,YAAAA,UAN8B,GAMjB,EANiB;AAO9BC,YAAAA,CAP8B,GAO1B,CAP0B,EAQhCC,GARgC,GAQ1BH,kBAAkB,CAACI,MARO;;AAAA;AAAA,kBAS3BF,CAAC,GAAGC,GATuB;AAAA;AAAA;AAAA;;AAAA,iBAU5B,4BAAc,CAACP,GAAD,EAAMC,GAAN,CAAd,EAA0BG,kBAAkB,CAACE,CAAD,CAAlB,CAAsBG,OAAhD,CAV4B;AAAA;AAAA;AAAA;;AAW9BJ,YAAAA,UAAU,CAACK,IAAX,CAAgBN,kBAAkB,CAACE,CAAD,CAAlB,CAAsBK,SAAtC;AAX8B,8CAYvB;AACLlB,cAAAA,MAAM,EAAE,SADH;AAELmB,cAAAA,IAAI,EAAER,kBAAkB,CAACE,CAAD,CAAlB,CAAsBK,SAAtB,CAAgCE;AAFjC,aAZuB;;AAAA;AAkBhCP,YAAAA,CAAC;AAlB+B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAApBP,oBAAoB;AAAA;AAAA;AAAA,GAA1B;;;;AAsBA,IAAMe,qBAAqB;AAAA,4FAAG,kBAAMpC,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACdQ,kBAAMC,KAAN,GAAcgB,gBAAd,CAA+B,WAA/B,WACd,UAACd,CAAD,EAAO;AAACC,cAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AAAe,qBAAO,EAAP;AAAW,aADpB,CADc;;AAAA;AAC7BwB,YAAAA,MAD6B;AAAA,8CAG5B;AACLpB,cAAAA,MAAM,EAAE,SADH;AAELmB,cAAAA,IAAI,EAAEC;AAFD,aAH4B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAArBC,qBAAqB;AAAA;AAAA;AAAA,GAA3B","sourcesContent":["import Brand from '../models/brand'\nimport Cokitchen from '../models/cokitchen'\nimport CokitchenPolygon from '../models/cokitchen_polygon'\nimport { checkIfAdmin, checkIfMarketing } from '../services/RoleService'\nimport { Unauthorized, insidePolygon, UnprocessableEntity } from '../helpers'\n\nexport const createBrand = async ctx => {\n  const { id } = ctx.params\n  const { body } = ctx.request\n  const { role } = ctx.state.user.user\n\n  if (await checkIfMarketing(role)) {\n    const brand_data = await Brand.query()\n      .insert(body)\n      .catch(e => {\n        console.log(e)\n        throw UnprocessableEntity('Invalid body')\n      })\n    return {\n      status: 'success',\n      message: 'Brand Created Successfully',\n      ...brand_data\n    }\n  } else {\n    throw Unauthorized('Unauthorized Creation')\n  }\n}\n\nexport const updateBrand = async ctx => {\n  const { body } = ctx.request\n  const { role } = ctx.state.user.user\n  const brand_id = body.brand_id\n  delete body.brand_id\n  if (await checkIfMarketing(role)) {\n    if (body.posist_data) {\n      delete body.posist_data\n    }\n    const brand_data = await Brand.query().patchAndFetchById(\n      brand_id,\n      body\n    )\n    return {\n      status: 'success',\n      message: 'Update Successful',\n      ...brand_data\n    }\n  } else {\n    throw Unauthorized('Unauthorized Update')\n  }\n}\n\nexport const getBrandsForCustomer = async ctx => {\n  const { body } = ctx.request\n  const { lat, lng } = body\n  const cokitchen_polygons = await CokitchenPolygon.query().withGraphFetched(\n    '[cokitchen.[brands.[meals]]]'\n  )\n  var cokitchens = []\n  var i = 0,\n    len = cokitchen_polygons.length\n  while (i < len) {\n    if (insidePolygon([lat, lng], cokitchen_polygons[i].polygon)) {\n      cokitchens.push(cokitchen_polygons[i].cokitchen)\n      return {\n        status: 'success',\n        data: cokitchen_polygons[i].cokitchen.brands\n      }\n    }\n\n    i++\n  }\n}\n\nexport const getBrandsForMarketing = async ctx => {\n  const brands = await Brand.query().withGraphFetched('cokitchen')\n  .catch((e) => {console.log(e);return [];})\n  return {\n    status: 'success',\n    data: brands\n  }\n}\n"],"file":"brand.controller.js"}